#include "igraph_error.h"
#include "igraph_interface.h"
#include "igraph_matrix.h"
#include "test_utilities.h"

#include <igraph.h>
#include <math.h>
#include <stdbool.h>

igraph_error_t delaunay(igraph_real_t *points, igraph_integer_t numpoints, igraph_integer_t dimension, igraph_bool_t printing) {

    igraph_matrix_t points_mat;

    igraph_t g;

    IGRAPH_CHECK(igraph_matrix_init_array(&points_mat, points, numpoints, dimension, false));
    IGRAPH_FINALLY(igraph_matrix_destroy, &points_mat);
    IGRAPH_CHECK(igraph_delaunay_triangulation(&g, &points_mat));
    IGRAPH_FINALLY(igraph_destroy, &g);
    if (printing) {
        printf("%li\n", igraph_ecount(&g));
        print_graph_canon(&g);
    }

    igraph_matrix_destroy(&points_mat);
    igraph_destroy(&g);
    IGRAPH_FINALLY_CLEAN(2);
    return IGRAPH_SUCCESS;
}

int main(void) {
    igraph_real_t points_raw[] = {
    0.311138, 0.59391, 0.67498, 0.1694, 0.822953, 0.904456, 0.129484,   \
    0.350282, 0.756002, 0.373154, 0.763904, 0.870096, 0.786728,         \
    0.00985041, 0.406027, 0.504641, 0.174089, 0.358568, 0.388813,       \
    0.744543, 0.0681765, 0.544161, 0.289917, 0.487095, 0.605402,        \
    0.270968, 0.978097, 0.955441, 0.495331, 0.688885, 0.693659, 0.579305, \
    0.169171, 0.623525, 0.725786, 0.250287, 0.00648143, 0.743068,       \
    0.71552, 0.534675, 0.757967, 0.533673, 0.804339, 0.113337, 0.445796, \
    0.410465, 0.38357, 0.918967, 0.906415, 0.893578, 0.501743, 0.914856, \
    0.561324, 0.818718, 0.158764, 0.903373, 0.213128, 0.702836, 0.672937, \
    0.291723, 0.855333, 0.0981787, 0.804335, 0.702915, 0.824296,        \
    0.294826, 0.702266, 0.346332, 0.223656, 0.640166, 0.404121, 0.151721, \
    0.32827, 0.290019, 0.875388, 0.221269, 0.260946, 0.443243, 0.97165, \
    0.11638, 0.246203, 0.447883, 0.987007, 0.0692745, 0.109563, 0.339652, \
    0.0666818, 0.318156, 0.92505, 0.439913, 0.575609, 0.577994, 0.494698, \
    0.335231, 0.5605, 0.701834, 0.863751, 0.129853, 0.641124, 0.277378, \
    0.897763, 0.429955, 0.331589, 0.925289, 0.980783, 0.835259, 0.291818, \
    0.693408, 0.631442, 0.53206, 0.159631, 0.350867, 0.699043, 0.993084, \
    0.638868, 0.933556, 0.524775, 0.598018, 0.565078, 0.639017, 0.480785, \
    0.0698051, 0.60897, 0.350966, 0.411467, 0.0688254, 0.430729,        \
    0.761323, 0.359096, 0.590563, 0.372144, 0.1754, 0.422717, 0.296634, \
    0.874941, 0.32733, 0.616607, 0.547951, 0.902168, 0.369618, 0.226083, \
    0.10907, 0.0655338, 0.456096, 0.633249, 0.676374, 0.9357, 0.945376, \
    0.581192, 0.95893, 0.655664, 0.316474, 0.752296, 0.14192, 0.0125042, \
    0.595269, 0.084296, 0.281774, 0.6996, 0.66766, 0.478567, 0.505426,  \
    0.716551, 0.232743, 0.191, 0.0114542, 0.609768, 0.903796, 0.772037, \
    0.60114, 0.758929, 0.770639, 0.968881, 0.382973, 0.248955, 0.290848, \
    0.752831, 0.0109218, 0.903305, 0.762493, 0.696122, 0.91684,         \
    0.0138796, 0.45168, 0.668332, 0.0793168, 0.499606, 0.321686,        \
    0.0934459, 0.499221, 0.92654, 0.917383, 0.479325, 0.147302, 0.9623, \
    0.124589, 0.752746, 0.127419, 0.211051, 0.410824
    };

    igraph_real_t points_lattice[] = {
    0,0,
    0,1,
    0,2,
    1,0,
    1,1,
    1,2,
    2,0,
    2,1,
    2,2
    };

    igraph_real_t points_colinear[] = {
        0,0,
        2,0,
        0,2,
        1,0
    };

    igraph_real_t points_not_quite_colinear[] = {
        0,0,
        2,0,
        0,2,
        1,0.0000000001
    };

    igraph_real_t points_all_colinear[] = {
    1,1,
    2,2,
    3,3,
    4,4,
    };

    delaunay(&points_colinear[0], 4, 2, true);
    delaunay(&points_raw[0], 100, 2, true);
    delaunay(&points_lattice[0], 9, 2, true);
    delaunay(&points_colinear[0], 4, 2, true);
    delaunay(&points_not_quite_colinear[0], 4, 2, true);
    CHECK_ERROR(delaunay(&points_all_colinear[0], 4, 2, true),IGRAPH_EINVAL);
    VERIFY_FINALLY_STACK();
}
